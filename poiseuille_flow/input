atom_style         rheo
dimension          3
boundary           p p p
units              lj
read_data          data
comm_modify        vel yes

variable	       rho0 equal 1.0
variable           n equal 1.0
variable           mp equal ${rho0}/${n}
mass               1 ${mp}

variable           h3 equal 3.0
variable           cs equal 1.0
variable           zeta equal 1.0

variable           eta equal 0.1
variable           D equal 1.0
variable	       kappa equal ${D}*${rho0}/${mp}
pair_style         rheo ${h3} artificial/visc ${zeta} 

set                group all sph/rho ${rho0}


fix               1 all rheo ${h3} CRK2 5 shift
fix               2 all rheo/constant/viscosity constant ${eta}

variable drho atom c_rho_peratom-1.0
variable invrho atom 1.0/c_rho_peratom
compute ke all temp
compute rho_ave all reduce ave v_drho
compute vol_ave all reduce ave v_invrho
compute            vmax all reduce max vy
compute            vmin all reduce min vy
thermo             100
thermo_style       custom step dt time ke pe press #vol #c_vmax c_vmin c_ke[1] c_ke[2] c_ke[3] c_rho_ave c_vol_ave

compute            rho_peratom all sph/rho/atom
dump               mydump all custom 1000 dump/dump.* id type x y z fx fy fz c_rho_peratom vx vy vz

variable           vprof atom 0.01*sin(x*2*PI/lx) 
#velocity           all set v_vprof 0.0 0.0 units box #Longitudinal
velocity           all set 0.0 v_vprof 0.0 units box #Transverse

compute           xbin all chunk/atom bin/1d x center 0.5
fix               vbin all ave/chunk 5000 1 5000 xbin vx vy file vprofile.dat

pair_coeff         * * ${rho0} ${cs}

run              20000
