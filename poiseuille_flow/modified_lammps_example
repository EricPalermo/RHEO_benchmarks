# 2-d LJ flow simulation

dimension	2
boundary	p s p
atom_style      rheo
comm_modify        vel yes
newton off

#Particle resolution
## Particle Lattice/Resolution Parameters
variable           sf equal 0.005 #25 #/${L} #scaling of unit cell #scale factor for particle resolution
# n is particle number density, depends on lattive
variable           nb equal 1    #number of basis atoms depends on lattice
variable           n equal ${nb}/(${sf}^2) # number of particles per volume
variable           del equal ${sf}#*sqrt(2) # distance between particles
lattice            sq ${n} #create a set of potential particle locations

# SPH Smoothing Kernel Length
variable           hd equal 3.5
variable           h3 equal ${hd}*${del}

# create simulation geometry

#lattice		hex 0.7
region		box block 0 20 0 10 -0.25 0.25
create_box	3 box
create_atoms	1 box

mass		1 1.0
mass		2 1.0
mass		3 1.0

# define groups

region	     1 block INF INF INF 1.25 INF INF
group	     lower region 1
region	     2 block INF INF 8.75 INF INF INF
group	     upper region 2
group	     boundary union lower upper
group	     flow subtract all boundary

set	     group lower type 2
set	     group upper type 3

#Potential parameters
variable           rho0 equal 1.0 #Equilibrium density P=cs^2(rho-rho0)
variable           mp equal ${rho0}/${n} #particle mass, fixed by density and number density
variable           cs equal 4.0 #speed of sound - for pressure EoS
variable           eta equal 0.01 #dynamic viscosity
variable           zeta equal 1 #artificial viscosity - stabilizing term
variable           Dr equal 0.05*${h3}*${cs} #density diffusion - stabilizing term to diffuse noise throughout the system


# initial velocities

compute	     mobile flow temp #Compute temperature for atoms in the flow group; label value as mobile
velocity     flow create 1.0 482748 temp mobile #Create ensemble of velocites (seed 482748) given T=1

fix                1 all rheo ${h3} Quintic 0 #shift # rhosum 1  shift
fix                2 all rheo/surface ${h3} 1.5 10                 
fix                3 all rheo/viscosity constant ${eta} 

pair_style         rheo ${h3} artificial/visc ${zeta} rho/damp ${Dr}  #pressure taitwater rho/damp ${Dr} 
pair_coeff         * * ${rho0} ${cs}

fix	     4 flow temp/rescale 200 1.0 1.0 0.02 1.0
fix_modify   4 temp mobile

# Couette flow

#velocity     lower set 0.0 0.0 0.0
#velocity     upper set 3.0 0.0 0.0
#fix	     3 boundary setforce 0.0 0.0 0.0
#fix	     4 all enforce2d

# Poiseuille flow

velocity     boundary set 0.0 0.0 0.0
fix	     5 lower setforce 0.0 0.0 0.0 #setforce resets the current force value to a given value
fix	     6 upper setforce 0.0 NULL 0.0
fix	     7 upper aveforce 0.0 -1.0 0.0 #Apply an external force so that all atoms experience the same force, used to fix a wall
fix	     8 flow addforce 0.5 0.0 0.0 #addforce adds a given force to the current value
fix	     9 all enforce2d

# Run

timestep	0.003
thermo		500
thermo_modify	temp mobile

dump		1 all atom 500 dump.flow

#dump		2 all image 100 image.*.jpg type type &
#		zoom 1.6 adiam 1.5
#dump_modify	2 pad 5

#dump		3 all movie 100 movie.mpg type type &
#		zoom 1.6 adiam 1.5
#dump_modify	3 pad 5

run		10000
